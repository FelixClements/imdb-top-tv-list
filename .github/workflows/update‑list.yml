name: Update IMDb Top TV List

# -----------------------------------------------------------------
# Triggers
# -----------------------------------------------------------------
on:
  schedule:
    - cron: '0 3 * * *'        # daily at 03:00‚ÄØUTC
  workflow_dispatch:           # manual run from the UI

# -----------------------------------------------------------------
# Job definition
# -----------------------------------------------------------------
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write           # needed for the commit & push

    steps:
      # -----------------------------------------------------------------
      # 1Ô∏è‚É£ Checkout the repo
      # -----------------------------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # -----------------------------------------------------------------
      # 2Ô∏è‚É£ Set up Python
      # -----------------------------------------------------------------
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # -----------------------------------------------------------------
      # 3Ô∏è‚É£ Install pip dependencies
      # -----------------------------------------------------------------
      - name: Install pip dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # -----------------------------------------------------------------
      # 4Ô∏è‚É£ Generate the three JSON lists (5‚ÄØ/‚ÄØ10‚ÄØ/‚ÄØ25)
      # -----------------------------------------------------------------
      - name: Generate top 5 JSON list
        run: |
          python generate_list.py -n 5 -o top_5.json
      - name: Wait a moment (timestamps)
        run: sleep 2

      - name: Generate top 10 JSON list
        run: |
          python generate_list.py -n 10 -o top_10.json
      - name: Wait a moment (timestamps)
        run: sleep 2

      - name: Generate top 25 JSON list
        run: |
          python generate_list.py -n 25 -o top_25.json
      - name: Wait a moment (timestamps)
        run: sleep 2

      # -----------------------------------------------------------------
      # 5Ô∏è‚É£ Commit & push any changed JSON files
      # -----------------------------------------------------------------
      - name: Commit JSON changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: |
            ü§ñ Update IMDb top‚Äë5 / top‚Äë10 / top‚Äë25 JSON lists
          # Use a glob that matches all three files (easier to extend later)
          file_pattern: "top_*.json"